<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Livro de Desenho do Kai</title>

    <style>
/* Estrelas douradas animadas */
body::after {
    content: "";
    pointer-events: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    z-index: -3;
    background-image:
        url('https://svgshare.com/i/13kP.svg'),
        url("data:image/svg+xml;utf8,<svg width='40' height='40' xmlns='http://www.w3.org/2000/svg'><polygon points='20,2 25,15 39,15 27,23 32,36 20,28 8,36 13,23 1,15 15,15' fill='%23ffe066' opacity='1'/><filter id='glow'><feGaussianBlur stdDeviation='2.5' result='coloredBlur'/><feMerge><feMergeNode in='coloredBlur'/><feMergeNode in='SourceGraphic'/></feMerge></filter></svg>"),
        url("data:image/svg+xml;utf8,<svg width='24' height='24' xmlns='http://www.w3.org/2000/svg'><circle cx='12' cy='12' r='6' fill='%23fffbe7' opacity='0.9'/><filter id='glow2'><feGaussianBlur stdDeviation='2.5' result='coloredBlur'/><feMerge><feMergeNode in='coloredBlur'/><feMergeNode in='SourceGraphic'/></feMerge></filter></svg>");
    background-repeat: repeat, repeat, repeat;
    background-size: auto, 120px, 60px;
    background-position: 0 0, 30vw 10vh, 70vw 60vh;
    animation: stars-move 60s linear infinite, gold-stars 18s linear infinite;
    opacity: 0.85; /* Aumente a opacidade geral */
    filter: drop-shadow(0 0 16px #ffe066) drop-shadow(0 0 32px #fffbe7);
}
@keyframes stars-move {
    0% { background-position: 0 0; }
    100% { background-position: 1000px 1000px; }
}
        body {
            background: radial-gradient(ellipse at 60% 20%, #ffe066 0%, #f7d358 15%, #0a1440 60%, #0a1440 100%);
            min-height: 100vh;
        }
        .livro-desenho {
            max-width: 900px;
            margin: 40px auto;
            background: #fffbe7;
            border-radius: 32px;
            box-shadow: 0 8px 40px rgba(10,20,64,0.18), 0 1.5px 0 #ffe066 inset;
            border: 6px solid #ffe066;
            padding: 32px 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            color: #bfa100;
            text-shadow: 0 0 18px #ffe066, 0 0 32px #fffbe7;
            font-family: 'Comic Sans MS', 'Comic Sans', cursive, Arial, sans-serif;
            margin-bottom: 16px;
        }
        .desenho-area {
            width: 100%;
            max-width: 700px;
            height: auto;
            aspect-ratio: 17/10; /* Mant√©m propor√ß√£o */
            margin: 24px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .desenho-area canvas {
            width: 100%;
            height: auto;
            max-width: 100%;
            max-height: 420px;
            display: block;
            background: transparent;
            border-radius: 16px;
            cursor: crosshair;
        }
        .botoes-desenho {
            margin-top: 16px;
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            justify-content: center;
            align-items: center;
        }
        .botoes-desenho label,
        .botoes-desenho button {
            margin-bottom: 8px;
        }
        .botoes-desenho button {
            background: #ffe066;
            color: #0a1440;
            border: none;
            border-radius: 8px;
            padding: 10px 22px;
            font-size: 1.1em;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 8px #ffe06644;
            transition: background 0.2s;
        }
        .botoes-desenho button:hover {
            background: #f7d358;
        }
        .instrucao {
            color: #bfa100;
            font-size: 1.1em;
            margin-bottom: 12px;
        }
        @media (max-width: 700px) {
            .botoes-desenho {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }
            .botoes-desenho label,
            .botoes-desenho button {
                width: 100%;
                justify-content: flex-start;
            }
            .botoes-desenho button {
                font-size: 1em;
                padding: 10px 0;
            }
        }
        @media (max-width: 700px) {
    .botoes-desenho button {
        font-size: 1em;
        padding: 10px 0;
    }
}

a {
    color: #0a1440;
    text-decoration: none;
    font-weight: bold;
    margin-top: 20px;
    font-size: 1.1em;
    transition: color 0.2s;
    text-shadow: 0 0 8px #ffe066, 0 0 16px #fffbe7;
}
    a:hover {
        color: #bfa100;
        text-decoration: underline;
    }
    </style>
</head>
<body>
    <div class="livro-desenho">
        <h1>Livro de Desenho do Kai</h1>
        <div class="instrucao">Desenhe aqui sua imagina√ß√£o! Use o mouse ou o dedo (no celular).</div>
        <div class="desenho-area">
            <canvas id="canvas" width="680" height="400"></canvas>
        </div>
        <div class="botoes-desenho">
            <label style="display:flex;align-items:center;gap:6px;">
                Cor: üé®
                <input type="color" id="corLinha" value="#bfa100" style="width:32px;height:32px;border:none;background:none;cursor:pointer;">
            </label>
            <label style="display:flex;align-items:center;gap:6px;">
                Tamanho:
                <select id="tamanhoLinha" style="padding:4px 8px;border-radius:6px;">
                    <option value="2">Pequeno .</option>
                    <option value="4" selected>M√©dio ¬∞</option>
                    <option value="8">Grande O</option>
                    <option value="16">Gigante ‚ö´</option>
                </select>
                <input type="number" id="tamanhoCustom" min="1" max="50" value="4" style="width:50px; margin-left:8px;">
                px
            </label>
            <!-- Adicione o controle de opacidade junto dos outros controles -->
            <label style="display:flex;align-items:center;gap:6px;">
                Opacidade:
                <input type="range" id="opacidadeLinha" min="0.1" max="1" step="0.01" value="1" style="width:70px;">
                <span id="opacidadeValor">100%</span>
            </label>
            <button onclick="limparDesenho()">Limpar ‚ùå</button>
            <button onclick="baixarDesenho()">Baixar Desenho üñºÔ∏è</button>
            <button id="btnBorracha" type="button">Borracha üßΩ</button>
            <button id="btnLapis" type="button" style="display:none;">L√°pis üñåÔ∏è</button>
            <button id="btnBalde" type="button">Balde ü™£</button>
            <button id="btnSurpresa" type="button">Desenho Surpresa ‚ú®</button>
            <button id="btnDefinido" type="button">Desenho Definido üèûÔ∏è</button>
        </div>
        <div class="botoes-desenho" style="margin-top:10px;">
            <button type="button" onclick="desenharSolNuvens()">Sol e Nuvens</button>
            <button type="button" onclick="desenharMontanhas()">Montanhas</button>
            <button type="button" onclick="desenharCasa()">Casa</button>
            <button type="button" onclick="desenharCidade()">Cidade</button>
            <button type="button" onclick="desenharEspaco()">Espa√ßo üöÄ</button>
            <button type="button" onclick="desenharPessoainhas()">Pessoainhas üë¶üëß</button>
        </div>
        <div class="botoes-desenho">
            <label style="display:flex;align-items:center;gap:6px;">
                <input type="file" id="inputImagem" accept="image/*" style="display:none;">
                <button type="button" id="btnImagem">Inserir Imagem üñºÔ∏è</button>
            </label>
        </div>
        <p>
            Muito obrigado por desenhar com o Kai! üåü<br>
        </p>
        <p>
            Apoie o projeto! diga o que achou, compartilhe com amigos e ajude a divulgar!<br>
        </p>
        <p>
            &copy; 2025 Kai. Todos os direitos reservados.<br>
        </p>
        <a href="index.html" class="">
            Voltar ao In√≠cio üè†
        </a>
    </div>
    <script src="main.js"></script>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let desenhando = false;

// Estado das ferramentas
let corAtual = "#bfa100";
let tamanhoAtual = 4;
let opacidadeAtual = 1;
let ferramenta = 'pincel';

// Elementos dos controles
const corInput = document.getElementById('corLinha');
const selectTamanho = document.getElementById('tamanhoLinha');
const inputTamanho = document.getElementById('tamanhoCustom');
const opacidadeInput = document.getElementById('opacidadeLinha');
const opacidadeValor = document.getElementById('opacidadeValor');
const btnBorracha = document.getElementById('btnBorracha');
const btnLapis = document.getElementById('btnLapis');
const btnBalde = document.getElementById('btnBalde');
const btnSurpresa = document.getElementById('btnSurpresa');
const btnDefinido = document.getElementById('btnDefinido');
const btnImagem = document.getElementById('btnImagem');
const inputImagem = document.getElementById('inputImagem');

// Atualiza controles
corInput.addEventListener('input', function() {
    corAtual = this.value;
});
selectTamanho.addEventListener('change', function() {
    tamanhoAtual = parseInt(this.value, 10);
    inputTamanho.value = tamanhoAtual;
});
inputTamanho.addEventListener('input', function() {
    let val = parseInt(this.value, 10);
    if (isNaN(val) || val < 1) val = 1;
    if (val > 100) val = 100;
    tamanhoAtual = val;
    selectTamanho.value = val;
});
opacidadeInput.addEventListener('input', function() {
    opacidadeAtual = parseFloat(this.value);
    opacidadeValor.textContent = Math.round(opacidadeAtual * 100) + "%";
});

// Alternar ferramentas
btnBorracha.addEventListener('click', function() {
    ferramenta = 'borracha';
    atualizarFerramenta();
});
btnLapis.addEventListener('click', function() {
    ferramenta = 'pincel';
    atualizarFerramenta();
});
btnBalde.addEventListener('click', function() {
    ferramenta = 'balde';
    canvas.style.cursor = "cell";
    atualizarFerramenta();
});
btnSurpresa.addEventListener('click', gerarDesenhoSurpresa);
btnDefinido.addEventListener('click', gerarDesenhoDefinido);
btnImagem.addEventListener('click', () => inputImagem.click());
inputImagem.addEventListener('change', inserirImagem);

function gerarDesenhoSurpresa() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.globalAlpha = 1;
    ctx.globalCompositeOperation = 'source-over';
    ctx.strokeStyle = "#0a1440";
    ctx.lineWidth = 3;

    // Exemplo: desenha formas aleat√≥rias
    for (let i = 0; i < 3 + Math.floor(Math.random() * 4); i++) {
        const tipo = Math.floor(Math.random() * 3);
        if (tipo === 0) { // c√≠rculo
            const x = 80 + Math.random() * 520;
            const y = 80 + Math.random() * 240;
            const r = 30 + Math.random() * 60;
            ctx.beginPath();
            ctx.arc(x, y, r, 0, 2 * Math.PI);
            ctx.stroke();
        } else if (tipo === 1) { // ret√¢ngulo
            const x = 40 + Math.random() * 540;
            const y = 40 + Math.random() * 280;
            const w = 60 + Math.random() * 120;
            const h = 40 + Math.random() * 100;
            ctx.beginPath();
            ctx.rect(x, y, w, h);
            ctx.stroke();
        } else { // linhas
            ctx.beginPath();
            ctx.moveTo(Math.random() * 680, Math.random() * 400);
            for (let j = 0; j < 3 + Math.floor(Math.random() * 3); j++) {
                ctx.lineTo(Math.random() * 680, Math.random() * 400);
            }
            ctx.stroke();
        }
    }
    ctx.restore();
}

function gerarDesenhoDefinido() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.globalAlpha = 1;
    ctx.globalCompositeOperation = 'source-over';
    ctx.strokeStyle = "#0a1440";
    ctx.lineWidth = 3;

    // Sorteia um cen√°rio
    const cenarios = [desenharSolNuvens, desenharMontanhas, desenharCasa, desenharCidade];
    const sorteado = cenarios[Math.floor(Math.random() * cenarios.length)];
    sorteado();

    ctx.restore();
}

// Exemplos de desenhos definidos:
function desenharSolNuvens() {
    ctx.clearRect(0, 0, canvas.width, canvas.height); // Limpa antes de desenhar
    ctx.save();
    ctx.globalAlpha = 1;
    ctx.globalCompositeOperation = 'source-over';
    ctx.strokeStyle = "#0a1440";
    ctx.lineWidth = 3;
    // Sol
    ctx.beginPath();
    ctx.arc(600, 80, 40, 0, 2 * Math.PI);
    ctx.stroke();
    for (let i = 0; i < 12; i++) {
        const angle = (i / 12) * 2 * Math.PI;
        ctx.beginPath();
        ctx.moveTo(600 + Math.cos(angle) * 50, 80 + Math.sin(angle) * 50);
        ctx.lineTo(600 + Math.cos(angle) * 70, 80 + Math.sin(angle) * 70);
        ctx.stroke();
    }
    // Nuvens
    ctx.beginPath();
    ctx.arc(120, 90, 30, Math.PI * 0.7, Math.PI * 1.3);
    ctx.arc(160, 90, 40, Math.PI * 0.8, Math.PI * 1.2);
    ctx.arc(200, 90, 30, Math.PI * 0.7, Math.PI * 1.3);
    ctx.stroke();
    ctx.restore();
}

function desenharMontanhas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.globalAlpha = 1;
    ctx.globalCompositeOperation = 'source-over';
    ctx.strokeStyle = "#0a1440";
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(0, 350);
    ctx.lineTo(100, 200);
    ctx.lineTo(200, 350);
    ctx.lineTo(300, 180);
    ctx.lineTo(400, 350);
    ctx.lineTo(500, 250);
    ctx.lineTo(600, 350);
    ctx.lineTo(680, 320);
    ctx.stroke();
    ctx.restore();
}

function desenharCasa() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.globalAlpha = 1;
    ctx.globalCompositeOperation = 'source-over';
    ctx.strokeStyle = "#0a1440";
    ctx.lineWidth = 3;
    // Base da casa
    ctx.beginPath();
    ctx.rect(250, 220, 180, 120);
    ctx.stroke();
    // Porta
    ctx.beginPath();
    ctx.rect(320, 270, 40, 70);
    ctx.stroke();
    // Telhado
    ctx.beginPath();
    ctx.moveTo(240, 220);
    ctx.lineTo(340, 140);
    ctx.lineTo(440, 220);
    ctx.closePath();
    ctx.stroke();
    // Janela
    ctx.beginPath();
    ctx.rect(270, 240, 30, 30);
    ctx.stroke();
    ctx.beginPath();
    ctx.rect(380, 240, 30, 30);
    ctx.stroke();
    ctx.restore();
}

function desenharCidade() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.globalAlpha = 1;
    ctx.globalCompositeOperation = 'source-over';
    ctx.strokeStyle = "#0a1440";
    ctx.lineWidth = 3;
    // Pr√©dios simples
    for (let i = 0; i < 5; i++) {
        const x = 80 + i * 110;
        const h = 100 + Math.random() * 80;
        ctx.beginPath();
        ctx.rect(x, 400 - h, 60, h);
        ctx.stroke();
        // Janelas
        for (let y = 400 - h + 20; y < 400; y += 25) {
            ctx.beginPath();
            ctx.rect(x + 10, y, 15, 15);
            ctx.stroke();
            ctx.beginPath();
            ctx.rect(x + 35, y, 15, 15);
            ctx.stroke();
        }
    }
    ctx.restore();
}

function desenharEspaco() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.globalAlpha = 1;
    ctx.globalCompositeOperation = 'source-over';
    ctx.strokeStyle = "#0a1440";
    ctx.lineWidth = 3;

    // Fundo estelar
    ctx.fillStyle = "#000";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    for (let i = 0; i < 100; i++) {
        const x = Math.random() * canvas.width;
        const y = Math.random() * canvas.height;
        ctx.fillStyle = `rgba(255, 255, 255, ${Math.random()})`;
        ctx.beginPath();
        ctx.arc(x, y, Math.random() * 2, 0, 2 * Math.PI);
        ctx.fill();
    }

    // Sol destacado (cor e tipo variados)
const tiposSolares = [
    { nome: "An√£ Marrom", cor: "#6b4f2a", brilho: "#bfa97a" },
    { nome: "Sol Vermelho", cor: "#ff3c1a", brilho: "#ffb3a1" },
    { nome: "Sol Laranja", cor: "#ff9900", brilho: "#ffe066" },
    { nome: "Sol Amarelo", cor: "#ffe066", brilho: "#fffbe7" },
    { nome: "Sol Azul", cor: "#3ccaff", brilho: "#b3e6ff" },
    { nome: "Sol Roxo", cor: "#a66cff", brilho: "#e0c6ff" },
    { nome: "Sol Branco", cor: "#fff", brilho: "#e0e0e0" },
    // Especiais (mais raros)
    { nome: "Quasar", cor: "#fff", brilho: "#00eaff", especial: true },
    { nome: "Buraco Negro", cor: "#111", brilho: "#444", especial: true },
    { nome: "Pulsar", cor: "#fff", brilho: "#aaf", especial: true }
];
// Sorteio com raridade para especiais
let tipoSol;
const especialChance = Math.random();
if (especialChance < 0.06) {
    const especiais = tiposSolares.filter(t => t.especial);
    tipoSol = especiais[Math.floor(Math.random() * especiais.length)];
} else {
    const comuns = tiposSolares.filter(t => !t.especial);
    tipoSol = comuns[Math.floor(Math.random() * comuns.length)];
}

// SORTEIE O TAMANHO DO SOL AQUI:
const solR = 32 + Math.random() * 38; // Raio entre 32 e 70
const solX = 100, solY = 90;

ctx.save();
ctx.shadowColor = tipoSol.brilho;
ctx.shadowBlur = tipoSol.especial ? 60 : 32;
ctx.beginPath();
ctx.arc(solX, solY, solR, 0, 2 * Math.PI);
ctx.fillStyle = tipoSol.cor;
ctx.fill();
ctx.shadowBlur = 0;
ctx.lineWidth = 4;
ctx.strokeStyle = tipoSol.brilho;
ctx.stroke();

// Raios do sol (exceto buraco negro)
if (tipoSol.nome !== "Buraco Negro") {
    for (let i = 0; i < 16; i++) {
        const angle = (i / 16) * 2 * Math.PI;
        const r1 = solR + 8;
        const r2 = solR + (tipoSol.especial ? 48 : 28);
        ctx.beginPath();
        ctx.moveTo(solX + Math.cos(angle) * r1, solY + Math.sin(angle) * r1);
        ctx.lineTo(solX + Math.cos(angle) * r2, solY + Math.sin(angle) * r2);
        ctx.strokeStyle = tipoSol.brilho;
        ctx.lineWidth = tipoSol.especial ? 5 : 3;
        ctx.stroke();
    }
}
// Efeito especial para quasar e pulsar
if (tipoSol.nome === "Quasar") {
    ctx.save();
    ctx.globalAlpha = 0.7;
    ctx.strokeStyle = "#00eaff";
    ctx.lineWidth = 10;
    ctx.beginPath();
    ctx.arc(solX, solY, solR + 30, 0, 2 * Math.PI);
    ctx.stroke();
    ctx.restore();
}
if (tipoSol.nome === "Pulsar") {
    ctx.save();
    ctx.globalAlpha = 0.7;
    ctx.strokeStyle = "#aaf";
    ctx.lineWidth = 6;
    for (let i = 0; i < 4; i++) {
        ctx.beginPath();
        ctx.moveTo(solX, solY);
        ctx.lineTo(solX + Math.cos(i * Math.PI / 2) * 120, solY + Math.sin(i * Math.PI / 2) * 120);
        ctx.stroke();
    }
    ctx.restore();
}

// Planetas (c√≠rculos preenchidos com cor aleat√≥ria e sombra do sol)
for (let i = 0; i < 3 + Math.floor(Math.random() * 3); i++) {
    const x = 220 + Math.random() * 400;
    const y = 100 + Math.random() * 250;
    const r = 20 + Math.random() * 30;
    const cor = `hsl(${Math.random() * 360}, 80%, 60%)`;

    // Calcula o √¢ngulo do planeta em rela√ß√£o ao sol
    const dx = solX - x;
    const dy = solY - y;
    const angSol = Math.atan2(dy, dx);

    // Metade iluminada (voltada para o sol)
    ctx.beginPath();
    ctx.arc(x, y, r, angSol - Math.PI/2, angSol + Math.PI/2, false);
    ctx.lineTo(x, y);
    ctx.closePath();
    ctx.fillStyle = cor;
    ctx.fill();

    // Metade escura (lado oposto ao sol)
    ctx.beginPath();
    ctx.arc(x, y, r, angSol + Math.PI/2, angSol - Math.PI/2, false);
    ctx.lineTo(x, y);
    ctx.closePath();
    ctx.fillStyle = "#222";
    ctx.fill();

    // Contorno do planeta
    ctx.beginPath();
    ctx.arc(x, y, r, 0, 2 * Math.PI);
    ctx.strokeStyle = "#0a1440";
    ctx.lineWidth = 3;
    ctx.stroke();

    // Anel em alguns planetas
    if (i % 2 === 1) {
        ctx.save();
        ctx.translate(x, y);
        ctx.rotate(Math.PI / 6);
        ctx.beginPath();
        ctx.ellipse(0, 0, r + 10, r / 2, 0, 0, 2 * Math.PI);
        ctx.strokeStyle = "#0a1440";
        ctx.lineWidth = 2;
        ctx.stroke();
        ctx.restore();
    }

    // Luas (0 a 3 por planeta, coloridas e com sombra)
    const numLuas = Math.floor(Math.random() * 4);
    for (let l = 0; l < numLuas; l++) {
        const angLua = Math.random() * 2 * Math.PI;
        const dist = r + 18 + Math.random() * 12;
        const luaX = x + Math.cos(angLua) * dist;
        const luaY = y + Math.sin(angLua) * dist;
        const luaR = 5 + Math.random() * 4;
        const corLua = `hsl(${Math.random() * 360}, 40%, 80%)`;

        // Sombra da lua (mesma l√≥gica do planeta)
        const dxLua = solX - luaX;
        const dyLua = solY - luaY;
        const angSolLua = Math.atan2(dyLua, dxLua);

        // Metade iluminada da lua
        ctx.beginPath();
        ctx.arc(luaX, luaY, luaR, angSolLua - Math.PI/2, angSolLua + Math.PI/2, false);
        ctx.lineTo(luaX, luaY);
        ctx.closePath();
        ctx.fillStyle = corLua;
        ctx.fill();

        // Metade escura da lua
        ctx.beginPath();
        ctx.arc(luaX, luaY, luaR, angSolLua + Math.PI/2, angSolLua - Math.PI/2, false);
        ctx.lineTo(luaX, luaY);
        ctx.closePath();
        ctx.fillStyle = "#888";
        ctx.fill();

        // Contorno da lua
        ctx.beginPath();
        ctx.arc(luaX, luaY, luaR, 0, 2 * Math.PI);
        ctx.strokeStyle = "#888";
        ctx.lineWidth = 1.5;
        ctx.stroke();
    }
}
ctx.restore();
}

function desenharPessoainhas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.globalAlpha = 1;
    ctx.globalCompositeOperation = 'source-over';
    ctx.strokeStyle = "#0a1440";
    ctx.lineWidth = 3;

    // Sorteia de 2 a 6 pessoas
    const qtd = 2 + Math.floor(Math.random() * 5);
    for (let i = 0; i < qtd; i++) {
        const x = 80 + Math.random() * 520;
        const y = 160 + Math.random() * 180;
        const tamanho = 32 + Math.random() * 24;

        // Cabe√ßa
        ctx.beginPath();
        ctx.arc(x, y - tamanho * 0.7, tamanho * 0.32, 0, 2 * Math.PI);
        ctx.stroke();

        // Corpo
        ctx.beginPath();
        ctx.moveTo(x, y - tamanho * 0.38);
        ctx.lineTo(x, y + tamanho * 0.38);
        ctx.stroke();

        // Bra√ßos
        ctx.beginPath();
        ctx.moveTo(x - tamanho * 0.5, y);
        ctx.lineTo(x + tamanho * 0.5, y);
        ctx.stroke();

        // Pernas
        ctx.beginPath();
        ctx.moveTo(x, y + tamanho * 0.38);
        ctx.lineTo(x - tamanho * 0.35, y + tamanho * 0.95);
        ctx.moveTo(x, y + tamanho * 0.38);
        ctx.lineTo(x + tamanho * 0.35, y + tamanho * 0.95);
        ctx.stroke();

        // (Opcional) Detalhes: saia, chap√©u, etc.
        if (Math.random() > 0.5) {
            // Saia
            ctx.beginPath();
            ctx.moveTo(x, y + tamanho * 0.1);
            ctx.lineTo(x - tamanho * 0.22, y + tamanho * 0.38);
            ctx.lineTo(x + tamanho * 0.22, y + tamanho * 0.38);
            ctx.closePath();
            ctx.stroke();
        }
        if (Math.random() > 0.7) {
            // Chap√©u
            ctx.beginPath();
            ctx.moveTo(x - tamanho * 0.18, y - tamanho * 0.9);
            ctx.lineTo(x + tamanho * 0.18, y - tamanho * 0.9);
            ctx.lineTo(x, y - tamanho * 1.2);
            ctx.closePath();
            ctx.stroke();
        }
    }
    ctx.restore();
}

// Atualiza bot√µes de ferramenta
function atualizarFerramenta() {
    if (ferramenta === 'borracha') {
        btnBorracha.style.display = 'none';
        btnLapis.style.display = 'inline-block';
        canvas.style.cursor = "crosshair";
    } else if (ferramenta === 'pincel') {
        btnBorracha.style.display = 'inline-block';
        btnLapis.style.display = 'none';
        canvas.style.cursor = "crosshair";
    } else if (ferramenta === 'balde') {
        btnBorracha.style.display = 'inline-block';
        btnLapis.style.display = 'none';
        canvas.style.cursor = "cell";
    } else if (ferramenta === 'surpresa') {
        btnBorracha.style.display = 'inline-block';
        btnLapis.style.display = 'none';
        canvas.style.cursor = "crosshair";
    }
}
atualizarFerramenta();

// Desenho mouse
canvas.addEventListener('mousedown', (e) => {
    if (ferramenta === 'balde' || ferramenta === 'surpresa') return;
    desenhando = true;
    const pos = getPos(e);
    ctx.beginPath();
    ctx.moveTo(pos.x, pos.y);
});
canvas.addEventListener('mousemove', (e) => {
    if (!desenhando || ferramenta === 'balde' || ferramenta === 'surpresa') return;
    const pos = getPos(e);
    ctx.lineTo(pos.x, pos.y);
    ctx.lineWidth = tamanhoAtual;
    ctx.lineCap = "round";
    ctx.globalCompositeOperation = 'source-over';
    if (ferramenta === 'borracha') {
        ctx.strokeStyle = hexToRgba('#fff', opacidadeAtual);
    } else {
        ctx.strokeStyle = hexToRgba(corAtual, opacidadeAtual);
    }
    ctx.stroke();
});
canvas.addEventListener('mouseup', () => desenhando = false);
canvas.addEventListener('mouseleave', () => desenhando = false);

// Desenho touch
canvas.addEventListener('touchstart', (e) => {
    if (ferramenta === 'balde' || ferramenta === 'surpresa') return;
    desenhando = true;
    const pos = getPos(e);
    ctx.beginPath();
    ctx.moveTo(pos.x, pos.y);
});
canvas.addEventListener('touchmove', (e) => {
    if (!desenhando || ferramenta === 'balde' || ferramenta === 'surpresa') return;
    e.preventDefault();
    const pos = getPos(e);
    ctx.lineTo(pos.x, pos.y);
    ctx.lineWidth = tamanhoAtual;
    ctx.lineCap = "round";
    ctx.globalCompositeOperation = 'source-over';
    if (ferramenta === 'borracha') {
        ctx.strokeStyle = hexToRgba('#fff', opacidadeAtual);
    } else {
        ctx.strokeStyle = hexToRgba(corAtual, opacidadeAtual);
    }
    ctx.stroke();
}, { passive: false });
canvas.addEventListener('touchend', () => desenhando = false);

// Balde de tinta (flood fill)
canvas.addEventListener('click', function(e) {
    if (ferramenta !== 'balde') return;
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    floodFill(x, y, corAtual, opacidadeAtual);
    ferramenta = 'pincel';
    canvas.style.cursor = "crosshair";
    atualizarFerramenta();
});

// Limpar e baixar
window.limparDesenho = function() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
}
window.baixarDesenho = function() {
    const link = document.createElement('a');
    link.download = 'meu-desenho.png';
    link.href = canvas.toDataURL();
    link.click();
}

// Fun√ß√£o auxiliar para cor RGBA
function hexToRgba(hex, alpha) {
    const r = parseInt(hex.substr(1,2),16);
    const g = parseInt(hex.substr(3,2),16);
    const b = parseInt(hex.substr(5,2),16);
    return `rgba(${r},${g},${b},${alpha})`;
}

// Flood fill (balde)
function floodFill(x, y, fillColor, fillAlpha) {
    const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const data = imgData.data;
    const width = imgData.width;

    const startPos = (Math.floor(y) * width + Math.floor(x)) * 4;
    const startColor = [
        data[startPos],
        data[startPos + 1],
        data[startPos + 2],
        data[startPos + 3]
    ];

    const fillR = parseInt(fillColor.substr(1, 2), 16);
    const fillG = parseInt(fillColor.substr(3, 2), 16);
    const fillB = parseInt(fillColor.substr(5, 2), 16);
    const fillA = Math.round(fillAlpha * 255);

    if (
        startColor[0] === fillR &&
        startColor[1] === fillG &&
        startColor[2] === fillB &&
        startColor[3] === fillA
    ) return;

    function matchColor(pos) {
        return (
            data[pos] === startColor[0] &&
            data[pos + 1] === startColor[1] &&
            data[pos + 2] === startColor[2] &&
            data[pos + 3] === startColor[3]
        );
    }
    function colorPixel(pos) {
        data[pos] = fillR;
        data[pos + 1] = fillG;
        data[pos + 2] = fillB;
        data[pos + 3] = fillA;
    }

    const stack = [startPos];
    while (stack.length) {
        const pos = stack.pop();
        if (!matchColor(pos)) continue;
        colorPixel(pos);

        if (pos + 4 < data.length) stack.push(pos + 4); // direita
        if (pos - 4 >= 0) stack.push(pos - 4); // esquerda
        if (pos + width * 4 < data.length) stack.push(pos + width * 4); // baixo
        if (pos - width * 4 >= 0) stack.push(pos - width * 4); // cima
    }
    ctx.putImageData(imgData, 0, 0);
}

// Pega posi√ß√£o mouse/touch
function getPos(e) {
    if (e.touches) {
        return {
            x: e.touches[0].clientX - canvas.getBoundingClientRect().left,
            y: e.touches[0].clientY - canvas.getBoundingClientRect().top
        };
    } else {
        return {
            x: e.offsetX,
            y: e.offsetY
        };
    }
}

// Inserir imagem no canvas
function inserirImagem() {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        }
        img.src = e.target.result;
    }
    reader.readAsDataURL(file);
}
</script>
</body>
</html>